{namespace be = TYPO3\CMS\Backend\ViewHelpers}
{namespace core = TYPO3\CMS\Core\ViewHelpers}

<f:layout name="Permission" />

<f:section name="headline">
	<h1>
		<f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:permissions" />:
		<f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Edit" />
	</h1>
</f:section>

<f:section name="content">
	<script src="../../../{extRelPath}res/acl.js" type="text/javascript"></script>

	<f:form action="update" name="editform">

		<div class="form-group">
			<label><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Owner" /></label>
			<f:form.select name="data[pages][{id}][perms_userid]" options="{beUserData}" value="{currentBeUser}" class="form-control" />
		</div>

		<div class="form-group">
			<label><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Group" /></label>
			<f:if condition="{f:count(subject:beGroupData)} > 1">
				<f:then>
					<f:form.select name="data[pages][{id}][perms_groupid]" options="{beGroupData}" value="{currentBeGroup}" class="form-control" />
				</f:then>
				<f:else>
					<div class="alert alert-notice"><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:noGroups" /></div>
				</f:else>
			</f:if>
		</div>

		<div class="panel panel-default panel-space">
			<div class="table-fit">
				<table class="table table-striped table-hover" id="typo3-permissionMatrix">
					<thead>
						<tr>
							<th></th>
							<th><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:1" /></th>
							<th><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:16" /></th>
							<th><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:2" /></th>
							<th><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:4" /></th>
							<th><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:8" /></th>
							<f:if condition="{perms_acls}">
								<th>{f:translate(key: 'LLL:EXT:be_acl/res/locallang_perm.xml:recursiveAcl')}</th>
								<th></th>
							</f:if>
						</tr>
					</thead>
					<tbody>
						<f:if condition="{disableOldPermissionSystem}">
							<f:then></f:then>
							<f:else>
								<tr>
									<td><strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Owner" /></strong></td>
									<td><input type="checkbox" name="check[perms_user][1]" onclick="TYPO3.Permissions.checkChange('check[perms_user]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]')" /></td>
									<td><input type="checkbox" name="check[perms_user][5]" onclick="TYPO3.Permissions.checkChange('check[perms_user]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]')" /></td>
									<td><input type="checkbox" name="check[perms_user][2]" onclick="TYPO3.Permissions.checkChange('check[perms_user]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]')" /></td>
									<td><input type="checkbox" name="check[perms_user][3]" onclick="TYPO3.Permissions.checkChange('check[perms_user]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]')" /></td>
									<td><input type="checkbox" name="check[perms_user][4]" onclick="TYPO3.Permissions.checkChange('check[perms_user]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]')" /></td>
									<f:if condition="{perms_acls}">
										<td></td>
										<td></td>
									</f:if>
								</tr>
								<tr>
									<td><strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Group" /></strong></td>
									<td><input type="checkbox" name="check[perms_group][1]" onclick="TYPO3.Permissions.checkChange('check[perms_group]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]')" /></td>
									<td><input type="checkbox" name="check[perms_group][5]" onclick="TYPO3.Permissions.checkChange('check[perms_group]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]')" /></td>
									<td><input type="checkbox" name="check[perms_group][2]" onclick="TYPO3.Permissions.checkChange('check[perms_group]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]')" /></td>
									<td><input type="checkbox" name="check[perms_group][3]" onclick="TYPO3.Permissions.checkChange('check[perms_group]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]')" /></td>
									<td><input type="checkbox" name="check[perms_group][4]" onclick="TYPO3.Permissions.checkChange('check[perms_group]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]')" /></td>
									<f:if condition="{perms_acls}">
										<td></td>
										<td></td>
									</f:if>
								</tr>
								<tr>
									<td><strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Everybody" /></strong></td>
									<td><input type="checkbox" name="check[perms_everybody][1]" onclick="TYPO3.Permissions.checkChange('check[perms_everybody]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]')" /></td>
									<td><input type="checkbox" name="check[perms_everybody][5]" onclick="TYPO3.Permissions.checkChange('check[perms_everybody]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]')" /></td>
									<td><input type="checkbox" name="check[perms_everybody][2]" onclick="TYPO3.Permissions.checkChange('check[perms_everybody]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]')" /></td>
									<td><input type="checkbox" name="check[perms_everybody][3]" onclick="TYPO3.Permissions.checkChange('check[perms_everybody]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]')" /></td>
									<td><input type="checkbox" name="check[perms_everybody][4]" onclick="TYPO3.Permissions.checkChange('check[perms_everybody]', 'tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]')" /></td>
									<f:if condition="{perms_acls}">
										<td></td>
										<td></td>
									</f:if>
								</tr>
							</f:else>
						</f:if>

						<f:if condition="{perms_acls}">
                            <f:for each="{perms_acls}" as="perm_acl">
                                <tr>
                                    <td>
                                        <f:form.select name="data[tx_beacl_acl][{perm_acl.uid}][type]" options="{0: 'User', 1: 'Group'}" value="1" />
                                        <f:form.select name="data[tx_beacl_acl][{perm_acl.uid}][object_id]" options="{beGroupData}" value="{currentBeGroup}" />
                                    </td>
                                    <td><input type="checkbox" name="check[perms_acl_{perm_acl.uid}][1]" onclick="TYPO3.Permissions.checkChange('check[perms_acl_{perm_acl.uid}]', 'tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]')" /></td>
                                    <td><input type="checkbox" name="check[perms_acl_{perm_acl.uid}][5]" onclick="TYPO3.Permissions.checkChange('check[perms_acl_{perm_acl.uid}]', 'tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]')" /></td>
                                    <td><input type="checkbox" name="check[perms_acl_{perm_acl.uid}][2]" onclick="TYPO3.Permissions.checkChange('check[perms_acl_{perm_acl.uid}]', 'tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]')" /></td>
                                    <td><input type="checkbox" name="check[perms_acl_{perm_acl.uid}][3]" onclick="TYPO3.Permissions.checkChange('check[perms_acl_{perm_acl.uid}]', 'tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]')" /></td>
                                    <td><input type="checkbox" name="check[perms_acl_{perm_acl.uid}][4]" onclick="TYPO3.Permissions.checkChange('check[perms_acl_{perm_acl.uid}]', 'tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]')" /></td>
                                    <td>
                                        <input type="hidden" name="data[tx_beacl_acl][{perm_acl.uid}][recursive]" value="0" />
                                        <input type="checkbox" name="data[tx_beacl_acl][{perm_acl.uid}][recursive]" value="1" {f:if(condition: '{perm_acl.recursive}', then: 'checked', else: '')} />
                                    </td>
                                    <td>
                                        <a href="javascript:deleteACL(1)"><core:icon identifier="actions-delete" /> {f:translate(key: 'LLL:EXT:be_acl/res/locallang_perm.xml:deleteAcl')}</a>
                                    </td>
                                </tr>
                            </f:for>
						</f:if>
					</tbody>
				</table>
			</div>
		</div>
		<div class="form-group">
			<span id="templateDeleteImage" style="display: none">
				<core:icon identifier="actions-delete" />
			</span>
			<span id="insertHiddenFields"></span>
			<a href="javascript:addACL()"><core:icon identifier="actions-document-new" /> {f:translate(key: 'LLL:EXT:be_acl/res/locallang_perm.xml:addAcl')}</a>
		</div>
		<div class="form-group">
			<label for="recursionLevel"><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Depth" /></label>
			<f:form.select id="recursionLevel" name="mirror[pages][{id}]" options="{recursiveSelectOptions}" class="form-control" />
		</div>

		<f:form.submit class="btn btn-default" name="submit" value="{f:translate(key: 'LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Save')}" />
		<f:link.action class="btn btn-default" action="index" arguments="{id: id}"><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Abort" /></f:link.action>

		<f:form.hidden name="data[pages][{id}][perms_user]" value="{pageInfo.perms_user}" />
		<f:form.hidden name="data[pages][{id}][perms_group]" value="{pageInfo.perms_group}" />
		<f:form.hidden name="data[pages][{id}][perms_everybody]" value="{pageInfo.perms_everybody}" />
        <f:for each="{perms_acls}" as="perm_acl">
            <f:form.hidden name="data[tx_beacl_acl][{perm_acl.uid}][permissions]" value="{perm_acl.permissions}" />
        </f:for>
		<f:form.hidden name="depth" value="{depth}" />
		<f:form.hidden name="redirect" value="{f:uri.action(action: 'index', arguments: {lastEdited: id, id: returnId})}" />
		<input type="hidden" name="pageID" value="{pageInfo.uid}" />
	</f:form>

	<hr>
	<h3><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:Legend" /></h3>
	<p>
		<strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:1" /></strong>: <f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:1_t" /> <br />
		<strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:16" /></strong>: <f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:16_t" /> <br />
		<strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:2" /></strong>: <f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:2_t" /> <br />
		<strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:4" /></strong>: <f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:4_t" /> <br />
		<strong><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:8" /></strong>: <f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:8_t" />
	</p>
	<p><f:translate key="LLL:EXT:beuser/Resources/Private/Language/locallang_mod_permission.xlf:def" /></p>

	<script type="text/javascript">
		require(["jquery", "TYPO3/CMS/Beuser/Permissions"], function($, Permissions) {
			Permissions.setCheck("check[perms_user]", "tx_beuser_system_beusertxpermission[data][pages][{id}][perms_user]");
			Permissions.setCheck("check[perms_group]", "tx_beuser_system_beusertxpermission[data][pages][{id}][perms_group]");
			Permissions.setCheck("check[perms_everybody]", "tx_beuser_system_beusertxpermission[data][pages][{id}][perms_everybody]");
            <f:for each="{perms_acls}" as="perm_acl">
               Permissions.setCheck("check[perms_acl_{perm_acl.uid}]", "tx_beuser_system_beusertxpermission[data][tx_beacl_acl][{perm_acl.uid}][permissions]");
            </f:for>
		});
	</script>

</f:section>
